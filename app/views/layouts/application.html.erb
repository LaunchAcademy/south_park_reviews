<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>South Park Reviews | <%= yield(:title) %></title>

    <%= stylesheet_link_tag    "application" %>
    <%= javascript_include_tag "vendor/modernizr" %>
    <%= csrf_meta_tags %>
    <%= favicon_link_tag 'favicon.ico' %>
  </head>

  <body>

    <nav class="top-bar" data-topbar role="navigation">
      <ul class="title-area">
        <li class="name">
          <h1><%= link_to 'South Park Reviews', root_path %></h1>
        </li>
      </ul>

      <section class="top-bar-section">
        <ul class="left">
          <li><%= image_tag('sign.png', class: "char-img") %></li>
          <li><%= image_tag('cartman.png', class: "char-img") %></li>
          <li class="has-form">
            <%= form_tag episodes_path, method: 'get', class: "has-form" do %>
              <div class="row collapse">
                <div class="large-8 small-9 columns">
                  <%= text_field_tag :search, nil, placeholder: "Search episodes" %>
                </div>
                <div class="large-4 small-3 columns">
                  <%= submit_tag "Search", name: nil, class: "alert button expand" %>
                </div>
              </div>
            <% end %>
          </li>
          <li><%= image_tag('kyle.png', class: "char-img") %></li>
          <li><%= image_tag('stan.png', class: "char-img") %></li>
          <li><%= image_tag('kenny.png', class: "char-img") %></li>
          <li><%= image_tag('butters.png', class: "char-img") %></li>
          <li class="divider space"></li>

          <li class="has-dropdown">
            <button data-dropdown="drop" aria-controls="drop" aria-expanded="false" class="tiny radius">Sort By</button>
            <ul id="drop" class="f-dropdown dropdown" data-dropdown-content aria-hidden="true" tabindex="-1">
              <li>
                <a href="#" data-dropdown="hover1" data-options="align:right">Find Season &raquo;</a>
                <ul id="hover1" class="f-dropdown" data-dropdown-content>
                  <li><%= link_to 'Special', { season: 0 } %></li>
                    <% (1..17).each do |i| %>
                      <li><%= link_to "Season #{i}", { season: "#{i}"} %></li>
                    <% end %>
                </ul>
              </li>
              <li><%= link_to "Most Votes", { votes: 1 } %></li>
              <li><%= link_to "Most Reviewed", { reviews: 1 } %></li>
              </ul>
            </li>
        </ul>

        <ul class="right">
          <li><%= image_tag('awesomo.png', class: "char-img") %></li>
          <li class="divider"></li>
          <% if signed_in? %>
            <li><%= user_avatar(current_user) %></li>

            <% if current_user.admin? %>
              <li><%= link_to "#{current_user.username} (Admin)", user_path(current_user) %></li>
            <% else %>
              <li><%= link_to current_user.username, user_path(current_user) %></li>
            <% end %>
            <li class="divider"></li>
            <li class="active">
              <%= link_to 'Sign out', destroy_user_session_path, data: {method: 'delete'} %>
            </li>
          <% else %>
            <li class="active">
              <%= link_to 'Sign In', new_user_session_path %>
            </li>
          <% end %>
        </ul>
      </section>
    </nav>

    <% if flash[:notice] %>
      <p class="notice"><%= flash[:notice] %></p>
    <% end %>

    <% if flash[:alert] %>
      <p class="alert-box"><%= flash[:alert] %></p>
    <% end %>

    <div class="row">
      <div class="small-12 columns">
        <%= yield %>
      </div>
    </div>

    <%= javascript_include_tag "application" %>
    <% @followed_users = current_user.is_following if current_user %>
    <% if @followed_users %>
      <ul>
        <% @followed_users.each do |user| %>
          <li><%= link_to user.username, user_path(user) %>
          <%= button_to "Unfollow #{user.username}", user_follow_path(user), method: :put, params: { followed_user: user.id } %></li>
        <% end %>
      </ul>
    <% end %>
  </body>
</html>
